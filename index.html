<!DOCTYPE html>
<html>
<head>
  <style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    background-color: #f0f0f0;
  }

  button {
    font-size: 28px;
    padding: 15px 30px;
    margin: 20px 0;
  }

  ul {
    list-style-type: none;
    padding: 0;
    max-width: 600px;
    margin: 0 auto;
  }

  li {
    font-size: 22px;
    margin: 10px 0;
    background: white;
    padding: 15px 20px;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .country-info {
    display: flex;
    align-items: center;
    gap: 10px;
    text-align: left;
  }

  .rank {
    font-weight: bold;
    width: 40px;
    text-align: right;
    color: #555;
  }

  .country-name {
    font-weight: bold;
    max-width: 250px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .click-count {
    font-weight: bold;
    font-size: 24px;
    color: #333;
    min-width: 80px;
    text-align: right;
    word-break: break-word;
  }

  img {
    width: 24px;
    height: 18px;
  }
  </style>

  <title>Global Click Battle!</title>
</head>
<body>

<h1>Global Click Battle!</h1>
<p>My Click: <span id="count">0</span></p>
<button onclick="clickButton()">Click!</button>
<h2>Global Rank</h2>
<ul id="ranking"></ul>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
const firebaseConfig = {
  databaseURL: "https://globalclick-63086-default-rtdb.asia-southeast1.firebasedatabase.app/"
};

firebase.initializeApp(firebaseConfig);

const db = firebase.database();

let country = "Unknown";
let countryCode = "UN";

fetch('https://ipapi.co/json/')
  .then(response => response.json())
  .then(data => {
    country = data.country_name;
    countryCode = data.country_code;
  });

let myClickCount = parseInt(localStorage.getItem("myClickCount")) || 0;
document.getElementById("count").innerText = myClickCount;

function clickButton() {
  const countryRef = db.ref("countries/" + country);

  countryRef.get().then((snapshot) => {
    let currentCount = snapshot.val() || 0;
    countryRef.set(currentCount + 1);
  });

  myClickCount++;
  document.getElementById("count").innerText = myClickCount;
  localStorage.setItem("myClickCount", myClickCount);
}

const countriesRef = db.ref("countries");

countriesRef.on("value", (snapshot) => {
  const countries = snapshot.val() || {};
  const rankingList = document.getElementById("ranking");

  const allCountries = {};
  const countryList = [
    "Afghanistan","Albania","Algeria","Andorra","Angola","Antigua and Barbuda","Argentina","Armenia","Australia","Austria","Azerbaijan","Bahamas",
    "Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bhutan","Bolivia","Bosnia and Herzegovina","Botswana","Brazil","Brunei",
    "Bulgaria","Burkina Faso","Burundi","Cabo Verde","Cambodia","Cameroon","Canada","Central African Republic","Chad","Chile","China","Colombia",
    "Comoros","Congo","Costa Rica","Croatia","Cuba","Cyprus","Czechia","Democratic Republic of the Congo","Denmark","Djibouti","Dominica","Dominican Republic",
    "Ecuador","Egypt","El Salvador","Equatorial Guinea","Eritrea","Estonia","Eswatini","Ethiopia","Fiji","Finland","France","Gabon","Gambia","Georgia",
    "Germany","Ghana","Greece","Grenada","Guatemala","Guinea","Guinea-Bissau","Guyana","Haiti","Honduras","Hungary","Iceland","India","Indonesia",
    "Iran","Iraq","Ireland","Israel","Italy","Jamaica","Japan","Jordan","Kazakhstan","Kenya","Kiribati","Kuwait","Kyrgyzstan","Laos","Latvia","Lebanon",
    "Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg","Madagascar","Malawi","Malaysia","Maldives","Mali","Malta","Marshall Islands",
    "Mauritania","Mauritius","Mexico","Micronesia","Moldova","Monaco","Mongolia","Montenegro","Morocco","Mozambique","Myanmar","Namibia","Nauru","Nepal",
    "Netherlands","New Zealand","Nicaragua","Niger","Nigeria","North Korea","North Macedonia","Norway","Oman","Pakistan","Palau","Palestine","Panama",
    "Papua New Guinea","Paraguay","Peru","Philippines","Poland","Portugal","Qatar","Romania","Russia","Rwanda","Saint Kitts and Nevis","Saint Lucia",
    "Saint Vincent and the Grenadines","Samoa","San Marino","Sao Tome and Principe","Saudi Arabia","Senegal","Serbia","Seychelles","Sierra Leone",
    "Singapore","Slovakia","Slovenia","Solomon Islands","Somalia","South Africa","South Korea","South Sudan","Spain","Sri Lanka","Sudan","Suriname",
    "Sweden","Switzerland","Syria","Tajikistan","Tanzania","Thailand","Timor-Leste","Togo","Tonga","Trinidad and Tobago","Tunisia","Turkey","Turkmenistan",
    "Tuvalu","Uganda","Ukraine","United Arab Emirates","United Kingdom","United States","Uruguay","Uzbekistan","Vanuatu","Vatican City","Venezuela",
    "Vietnam","Yemen","Zambia","Zimbabwe","Unknown"
  ];

  countryList.forEach(name => {
    allCountries[name] = countries[name] || 0;
  });

  const sortedCountries = Object.entries(allCountries).sort((a, b) => b[1] - a[1]);

  rankingList.innerHTML = "";
  sortedCountries.forEach(([countryName, clicks], index) => {
    const listItem = document.createElement("li");
    listItem.innerHTML = `
    <div class="country-info">
      <span class="rank">${index + 1}</span>
      ${countryNameToFlag(countryName)} <span class="country-name">${countryName}</span>
    </div>
    <div class="click-count">${clicks.toLocaleString()}</div>
    `;
    rankingList.appendChild(listItem);
  });
});

function countryNameToFlag(name) {
  if(name === "Unknown") return "";

  const code = nameToCode(name);
  return `<img src="https://flagcdn.com/24x18/${code.toLowerCase()}.png">`;
}

function nameToCode(name) {
  return name
    .toUpperCase()
    .replace(/ /g, "_")
    .replace(/[^A-Z_]/g, "")
    .slice(0, 2);
}
</script>

</body>
</html>

