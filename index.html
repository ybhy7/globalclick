<!DOCTYPE html>
<html>
<head>
  <style>
  body {
    font-family: Arial;
    text-align: center;
    background-color: #f7f7f7;
  }

  button {
    font-size: 20px;
    padding: 10px 20px;
  }

  ul {
    list-style-type: none;
    padding: 0;
  }

  li {
    font-size: 20px;
    margin: 5px 0;
  }

  h1 {
    font-size: 32px;
    margin-top: 20px;
  }

  p {
    font-size: 24px;
  }

  button {
    font-size: 28px;
    padding: 15px 30px;
    margin: 20px 0;
  }

  h2 {
    font-size: 28px;
    margin-top: 40px;
  }

  ul {
    list-style-type: none;
    padding: 0;
    max-width: 400px;
    margin: 0 auto;
  }

  li {
    font-size: 22px;
    margin: 10px 0;
    text-align: left;
    background: white;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 0 5px rgba(0,0,0,0.1);
  }

  img {
    margin-right: 10px;
    vertical-align: middle;
  }
  </style>

  <title>Global Click Battle!</title>
</head>
<body>

<h1>Global Click Battle!</h1>
<p>My Click: <span id="count">0</span></p>
<button onclick="clickButton()">Click!</button>
<h2>Global Rank</h2>
<ul id="ranking"></ul>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
// Firebase 설정
const firebaseConfig = {
  databaseURL: "https://globalclick-63086-default-rtdb.asia-southeast1.firebasedatabase.app/"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let country = "Unknown";
let countryCode = "UN";

fetch('https://ipapi.co/json/')
  .then(response => response.json())
  .then(data => {
    country = data.country_name;
    countryCode = data.country_code;
    console.log("당신의 나라는:", country, countryCode);
  });

let myClickCount = parseInt(localStorage.getItem("myClickCount")) || 0;
document.getElementById("count").innerText = myClickCount;

function clickButton() {
  const countryRef = db.ref("countries/" + country);
  countryRef.get().then((snapshot) => {
    let currentCount = snapshot.val() || 0;
    countryRef.set(currentCount + 1);
  });

  myClickCount += 1;
  document.getElementById("count").innerText = myClickCount;
  localStorage.setItem("myClickCount", myClickCount);
}

const countryNameToFlagData = {
  "South Korea": "KR", "United States": "US", "Japan": "JP", "China": "CN", "United Kingdom": "GB", "Germany": "DE", "France": "FR", "Unknown": "UN",
  "Trinidad and Tobago": "TT", "Russia": "RU", "Spain": "ES", "Mexico": "MX", "India": "IN", "Canada": "CA", "Australia": "AU", 
  // 여기에 더 많은 나라 추가 가능 (원하면 전세계 국가버전도 넣어드릴게요)
};

function countryNameToFlag(name) {
  const code = countryNameToFlagData[name] || "UN";
  return `<img src="https://flagcdn.com/24x18/${code.toLowerCase()}.png" style="vertical-align:middle;">`;
}

const countriesRef = db.ref("countries");

countriesRef.on("value", (snapshot) => {
  const countries = snapshot.val() || {};
  const rankingList = document.getElementById("ranking");

  const allCountries = {};
  for (const name in countryNameToFlagData) {
    allCountries[name] = countries[name] || 0;
  }

  const sortedCountries = Object.entries(allCountries).sort((a, b) => b[1] - a[1]);

  rankingList.innerHTML = "";
  sortedCountries.forEach(([countryName, clicks], index) => {
    const listItem = document.createElement("li");
    const flag = countryNameToFlag(countryName);

    listItem.innerHTML = `
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div style="max-width: 220px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
          ${index + 1} ${flag} ${countryName}
        </div>
        <div style="min-width: 80px; text-align: right;">
          ${clicks.toLocaleString()}
        </div>
      </div>
    `;

    rankingList.appendChild(listItem);
  });
});
</script>

</body>
</html>

